<div class="space-y-8">
 @if(loading()) {
    <div class="text-center py-20">
      <p class="text-gray-500">Chargement du profil client...</p>
    </div>
  } @else if (error(); as e) {
     <div class="text-center py-10 bg-white shadow rounded-lg">
      <h3 class="text-lg font-medium text-red-700">Erreur</h3>
      <p class="mt-1 text-sm text-gray-500">{{ e }}</p>
    </div>
  } @else if (client(); as c) {
    <!-- Header -->
    <header class="md:flex md:items-center md:justify-between">
      <div class="flex-1 min-w-0">
        <h1 class="text-3xl font-bold leading-tight text-gray-900 truncate">{{ c.firstName }} {{ c.lastName }}</h1>
        <p class="mt-1 text-sm text-gray-500">Client depuis le {{ c.createdAt | date:'longDate':'':'fr' }}</p>
      </div>
      <div class="mt-4 flex md:mt-0 md:ml-4 space-x-3">
        @if (!isEditMode()) {
          <button (click)="toggleEditMode()" type="button" class="inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500">
            <svg class="-ml-1 mr-2 h-5 w-5 text-gray-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z" /><path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd" /></svg>
            Modifier
          </button>
        } @else {
          <button (click)="toggleEditMode()" type="button" class="inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50">
            Annuler
          </button>
           <button (click)="saveChanges()" [disabled]="!clientForm.valid || !clientForm.dirty || isSaving()" type="button" class="inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 disabled:opacity-50 disabled:cursor-not-allowed">
            {{ isSaving() ? 'Enregistrement...' : 'Enregistrer' }}
          </button>
        }
      </div>
    </header>

    <!-- Client Info Card -->
    <div class="bg-white shadow-md rounded-lg p-6">
      <h2 class="text-xl font-semibold text-gray-800 mb-4">Informations de contact</h2>
      @if (!isEditMode()) {
        <dl class="grid grid-cols-1 gap-x-4 gap-y-6 sm:grid-cols-2">
          <div class="sm:col-span-1">
            <dt class="text-sm font-medium text-gray-500">Nom complet</dt>
            <dd class="mt-1 text-sm text-gray-900">{{ c.firstName }} {{ c.lastName }}</dd>
          </div>
          <div class="sm:col-span-1">
            <dt class="text-sm font-medium text-gray-500">Entreprise</dt>
            <dd class="mt-1 text-sm text-gray-900">{{ c.company || 'N/A' }}</dd>
          </div>
          <div class="sm:col-span-1">
            <dt class="text-sm font-medium text-gray-500">Adresse e-mail</dt>
            <dd class="mt-1 text-sm text-gray-900">{{ c.email }}</dd>
          </div>
          <div class="sm:col-span-1">
            <dt class="text-sm font-medium text-gray-500">Téléphone</dt>
            <dd class="mt-1 text-sm text-gray-900">{{ c.phone }}</dd>
          </div>
        </dl>
      } @else {
        <form [formGroup]="clientForm" class="grid grid-cols-1 gap-y-6 sm:grid-cols-2 sm:gap-x-4">
            <div>
              <label for="firstName" class="block text-sm font-medium text-gray-700">Prénom</label>
              <input type="text" id="firstName" formControlName="firstName" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm">
            </div>
            <div>
              <label for="lastName" class="block text-sm font-medium text-gray-700">Nom</label>
              <input type="text" id="lastName" formControlName="lastName" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm">
            </div>
            <div>
              <label for="email" class="block text-sm font-medium text-gray-700">Adresse e-mail</label>
              <input type="email" id="email" formControlName="email" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm">
            </div>
            <div>
              <label for="phone" class="block text-sm font-medium text-gray-700">Téléphone</label>
              <input type="tel" id="phone" formControlName="phone" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm">
            </div>
            <div class="sm:col-span-2">
              <label for="company" class="block text-sm font-medium text-gray-700">Entreprise</label>
              <input type="text" id="company" formControlName="company" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm">
            </div>
        </form>
      }
    </div>

    <!-- Bookings History -->
    <div class="bg-white shadow-md rounded-lg">
      <div class="p-6">
        <h2 class="text-xl font-semibold text-gray-800">Historique des réservations</h2>
      </div>
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Événement</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Montant</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Statut</th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            @for (booking of c.bookings; track booking.id) {
              <tr (click)="navigateToBooking(booking.id)" class="hover:bg-gray-50 cursor-pointer">
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{{ booking.eventName }}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ booking.eventDate | date:'dd/MM/yyyy' }}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ booking.totalAmount | currency:'EUR':'symbol':'1.2-2':'fr' }}</td>
                <td class="px-6 py-4 whitespace-nowrap">
                   <span [class]="'px-2 inline-flex text-xs leading-5 font-semibold rounded-full ' + getBookingStatusClass(booking.status)">
                    {{ booking.status }}
                  </span>
                </td>
              </tr>
            } @empty {
              <tr>
                <td colspan="4" class="px-6 py-4 text-center text-gray-500">Aucune réservation pour ce client.</td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    </div>
    
     <!-- Invoices History -->
    <div class="bg-white shadow-md rounded-lg">
      <div class="p-6">
        <h2 class="text-xl font-semibold text-gray-800">Historique des factures</h2>
      </div>
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">N° de Facture</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Type</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Montant</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Statut</th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
             @for (invoice of c.invoices; track invoice.id) {
              <tr (click)="navigateToInvoice(invoice.id)" class="hover:bg-gray-50 cursor-pointer">
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{{ invoice.id }}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ invoice.type }}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ invoice.amount | currency:'EUR':'symbol':'1.2-2':'fr' }}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ invoice.createdAt | date:'dd/MM/yyyy' }}</td>
                <td class="px-6 py-4 whitespace-nowrap">
                   <span [class]="'px-2 inline-flex text-xs leading-5 font-semibold rounded-full ' + getInvoiceStatusClass(invoice.status)">
                    {{ invoice.status }}
                  </span>
                </td>
              </tr>
            } @empty {
              <tr>
                <td colspan="5" class="px-6 py-4 text-center text-gray-500">Aucune facture pour ce client.</td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    </div>

  }
</div>
